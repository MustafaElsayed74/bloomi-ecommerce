<div class="management-container">
    <div class="management-header">
        <div>
            <h1>Product Management</h1>
            <p class="subtitle">Add, edit, or remove products</p>
        </div>
        <button class="btn-primary add-btn" (click)="openAddForm()" *ngIf="!showForm">
            ‚ûï Add New Product
        </button>
    </div>

    <div class="toast-container">
        <div *ngIf="errorMessage" class="toast toast-error">
            <div class="toast-icon-wrapper">
                <svg class="toast-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path
                        d="M10 18C14.4183 18 18 14.4183 18 10C18 5.58172 14.4183 2 10 2C5.58172 2 2 5.58172 2 10C2 14.4183 5.58172 18 10 18Z"
                        fill="currentColor" fill-opacity="0.15" />
                    <path d="M10 6V10M10 14H10.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
            </div>
            <div class="toast-body">
                <div class="toast-title">Error</div>
                <div class="toast-message">{{ errorMessage }}</div>
            </div>
            <button type="button" class="toast-close" (click)="errorMessage = ''" aria-label="Close">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <path d="M13.5 4.5L4.5 13.5M4.5 4.5L13.5 13.5" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" />
                </svg>
            </button>
            <div class="toast-progress"></div>
        </div>

        <div *ngIf="successMessage" class="toast toast-pink">
            <div class="toast-icon-wrapper">
                <svg class="toast-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path
                        d="M10 18C14.4183 18 18 14.4183 18 10C18 5.58172 14.4183 2 10 2C5.58172 2 2 5.58172 2 10C2 14.4183 5.58172 18 10 18Z"
                        fill="currentColor" fill-opacity="0.15" />
                    <path d="M6 10L8.5 12.5L14 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </div>
            <div class="toast-body">
                <div class="toast-title">Success</div>
                <div class="toast-message">{{ successMessage }}</div>
            </div>
            <button type="button" class="toast-close" (click)="successMessage = ''" aria-label="Close">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <path d="M13.5 4.5L4.5 13.5M4.5 4.5L13.5 13.5" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" />
                </svg>
            </button>
            <div class="toast-progress"></div>
        </div>
    </div>

    <div *ngIf="isLoading" class="loading-container">
        <div class="spinner"></div>
        <p>Loading products...</p>
    </div>

    <div *ngIf="!isLoading" class="management-content">
        <!-- Add/Edit Form -->
        <div *ngIf="showForm" class="form-section">
            <h2>{{ isEditing ? 'Edit Product' : 'Add New Product' }}</h2>
            <form [formGroup]="productForm" class="product-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="name">Product Name *</label>
                        <input type="text" id="name" formControlName="name" placeholder="Enter product name"
                            class="form-input" />
                        <span class="error"
                            *ngIf="productForm.get('name')?.invalid && productForm.get('name')?.touched">
                            Name must be at least 3 characters
                        </span>
                    </div>

                    <div class="form-group">
                        <label for="price">Price *</label>
                        <input type="number" id="price" formControlName="price" placeholder="0.00" step="0.01"
                            class="form-input" />
                        <span class="error"
                            *ngIf="productForm.get('price')?.invalid && productForm.get('price')?.touched">
                            Price must be greater than 0
                        </span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="category">Category *</label>
                        <input type="text" id="category" formControlName="category"
                            placeholder="e.g., Electronics, Clothing" class="form-input" />
                        <span class="error"
                            *ngIf="productForm.get('category')?.invalid && productForm.get('category')?.touched">
                            Category is required
                        </span>
                    </div>

                    <div class="form-group">
                        <label for="stock">Stock Quantity *</label>
                        <input type="number" id="stock" formControlName="stock" placeholder="0" min="0"
                            class="form-input" />
                        <span class="error"
                            *ngIf="productForm.get('stock')?.invalid && productForm.get('stock')?.touched">
                            Stock quantity must be 0 or more
                        </span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="description">Description *</label>
                    <textarea id="description" formControlName="description" placeholder="Enter product description"
                        class="form-input" rows="4"></textarea>
                    <span class="error"
                        *ngIf="productForm.get('description')?.invalid && productForm.get('description')?.touched">
                        Description must be at least 10 characters
                    </span>
                </div>

                <div class="form-group">
                    <label for="imageUrl">Image URL *</label>
                    <input type="url" id="imageUrl" formControlName="imageUrl"
                        placeholder="https://example.com/image.jpg" class="form-input" />
                    <span class="error"
                        *ngIf="productForm.get('imageUrl')?.invalid && productForm.get('imageUrl')?.touched">
                        Image URL is required
                    </span>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-primary" (click)="saveProduct()" [disabled]="!productForm.valid">
                        {{ isEditing ? 'üíæ Update Product' : '‚ûï Create Product' }}
                    </button>
                    <button type="button" class="btn-secondary" (click)="closeForm()">
                        ‚ùå Cancel
                    </button>
                </div>
            </form>
        </div>

        <!-- Search Bar -->
        <div *ngIf="!showForm" class="search-section">
            <input type="text" placeholder="Search products by name, category, or description..."
                [(ngModel)]="searchTerm" (input)="searchProducts()" class="search-input" />
            <span class="search-count">{{ filteredProducts.length }} products</span>
        </div>

        <!-- Products Table -->
        <div *ngIf="!showForm" class="table-section">
            <div class="table-container">
                <table class="products-table" *ngIf="filteredProducts.length > 0; else noProducts">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Price</th>
                            <th>Stock</th>
                            <th>Rating</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let product of filteredProducts">
                            <td class="product-name">{{ product.name }}</td>
                            <td class="category">{{ product.category }}</td>
                            <td class="price">EGP {{ product.price | number: '1.2-2' }}</td>
                            <td class="stock">
                                <span class="stock-badge" [class.low]="product.stock < 10">
                                    {{ product.stock }} units
                                </span>
                            </td>
                            <td class="rating">‚≠ê {{ product.rating | number: '1.1-1' }}</td>
                            <td class="actions">
                                <button class="action-edit" (click)="editProduct(product)" title="Edit">
                                    ‚úèÔ∏è
                                </button>
                                <button class="action-delete" (click)="deleteProduct(product.id)" title="Delete">
                                    üóëÔ∏è
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <ng-template #noProducts>
                    <div class="empty-state">
                        <p>{{ searchTerm ? 'No products found matching your search' : 'No products yet' }}</p>
                        <button class="btn-primary" (click)="openAddForm()" *ngIf="!searchTerm">
                            ‚ûï Add Your First Product
                        </button>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>
</div>