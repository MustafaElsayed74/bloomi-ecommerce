<div class="management-container">
    <div class="management-header">
        <div>
            <h1>Product Management</h1>
            <p class="subtitle">Add, edit, or remove products</p>
        </div>
        <button class="btn-primary add-btn" (click)="openAddForm()" *ngIf="!showForm">
            ‚ûï Add New Product
        </button>
    </div>

    <div *ngIf="successMessage" class="alert alert-success">
        <span>‚úì {{ successMessage }}</span>
    </div>

    <div *ngIf="errorMessage" class="alert alert-error">
        <span>‚ö†Ô∏è {{ errorMessage }}</span>
    </div>

    <div *ngIf="isLoading" class="loading-container">
        <div class="spinner"></div>
        <p>Loading products...</p>
    </div>

    <div *ngIf="!isLoading" class="management-content">
        <!-- Add/Edit Form -->
        <div *ngIf="showForm" class="form-section">
            <h2>{{ isEditing ? 'Edit Product' : 'Add New Product' }}</h2>
            <form [formGroup]="productForm" class="product-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="name">Product Name *</label>
                        <input type="text" id="name" formControlName="name" placeholder="Enter product name"
                            class="form-input" />
                        <span class="error"
                            *ngIf="productForm.get('name')?.invalid && productForm.get('name')?.touched">
                            Name must be at least 3 characters
                        </span>
                    </div>

                    <div class="form-group">
                        <label for="price">Price *</label>
                        <input type="number" id="price" formControlName="price" placeholder="0.00" step="0.01"
                            class="form-input" />
                        <span class="error"
                            *ngIf="productForm.get('price')?.invalid && productForm.get('price')?.touched">
                            Price must be greater than 0
                        </span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="category">Category *</label>
                        <input type="text" id="category" formControlName="category"
                            placeholder="e.g., Electronics, Clothing" class="form-input" />
                        <span class="error"
                            *ngIf="productForm.get('category')?.invalid && productForm.get('category')?.touched">
                            Category is required
                        </span>
                    </div>

                    <div class="form-group">
                        <label for="stock">Stock Quantity *</label>
                        <input type="number" id="stock" formControlName="stockQuantity" placeholder="0" min="0"
                            class="form-input" />
                        <span class="error"
                            *ngIf="productForm.get('stockQuantity')?.invalid && productForm.get('stockQuantity')?.touched">
                            Stock quantity must be 0 or more
                        </span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="description">Description *</label>
                    <textarea id="description" formControlName="description" placeholder="Enter product description"
                        class="form-input" rows="4"></textarea>
                    <span class="error"
                        *ngIf="productForm.get('description')?.invalid && productForm.get('description')?.touched">
                        Description must be at least 10 characters
                    </span>
                </div>

                <div class="form-group">
                    <label for="imageUrl">Image URL *</label>
                    <input type="url" id="imageUrl" formControlName="imageUrl"
                        placeholder="https://example.com/image.jpg" class="form-input" />
                    <span class="error"
                        *ngIf="productForm.get('imageUrl')?.invalid && productForm.get('imageUrl')?.touched">
                        Image URL is required
                    </span>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-primary" (click)="saveProduct()" [disabled]="!productForm.valid">
                        {{ isEditing ? 'üíæ Update Product' : '‚ûï Create Product' }}
                    </button>
                    <button type="button" class="btn-secondary" (click)="closeForm()">
                        ‚ùå Cancel
                    </button>
                </div>
            </form>
        </div>

        <!-- Search Bar -->
        <div *ngIf="!showForm" class="search-section">
            <input type="text" placeholder="Search products by name, category, or description..."
                [(ngModel)]="searchTerm" (input)="searchProducts()" class="search-input" />
            <span class="search-count">{{ filteredProducts.length }} products</span>
        </div>

        <!-- Products Table -->
        <div *ngIf="!showForm" class="table-section">
            <div class="table-container">
                <table class="products-table" *ngIf="filteredProducts.length > 0; else noProducts">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Price</th>
                            <th>Stock</th>
                            <th>Rating</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let product of filteredProducts">
                            <td class="product-name">{{ product.name }}</td>
                            <td class="category">{{ product.category }}</td>
                            <td class="price">${{ product.price | number: '1.2-2' }}</td>
                            <td class="stock">
                                <span class="stock-badge" [class.low]="product.stockQuantity < 10">
                                    {{ product.stockQuantity }} units
                                </span>
                            </td>
                            <td class="rating">‚≠ê {{ product.rating | number: '1.1-1' }}</td>
                            <td class="actions">
                                <button class="action-edit" (click)="editProduct(product)" title="Edit">
                                    ‚úèÔ∏è
                                </button>
                                <button class="action-delete" (click)="deleteProduct(product.id)" title="Delete">
                                    üóëÔ∏è
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <ng-template #noProducts>
                    <div class="empty-state">
                        <p>{{ searchTerm ? 'No products found matching your search' : 'No products yet' }}</p>
                        <button class="btn-primary" (click)="openAddForm()" *ngIf="!searchTerm">
                            ‚ûï Add Your First Product
                        </button>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>
</div>
