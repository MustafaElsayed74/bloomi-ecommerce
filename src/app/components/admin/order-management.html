<div class="management-container">
    <div class="management-header">
        <div>
            <h1>Order Management</h1>
            <p class="subtitle">View and manage customer orders</p>
        </div>
    </div>

    <div class="toast-container">
        <div *ngIf="errorMessage" class="toast toast-error">
            <div class="toast-icon-wrapper">
                <svg class="toast-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path
                        d="M10 18C14.4183 18 18 14.4183 18 10C18 5.58172 14.4183 2 10 2C5.58172 2 2 5.58172 2 10C2 14.4183 5.58172 18 10 18Z"
                        fill="currentColor" fill-opacity="0.15" />
                    <path d="M10 6V10M10 14H10.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
            </div>
            <div class="toast-body">
                <div class="toast-title">Error</div>
                <div class="toast-message">{{ errorMessage }}</div>
            </div>
            <button type="button" class="toast-close" (click)="errorMessage = ''" aria-label="Close">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <path d="M13.5 4.5L4.5 13.5M4.5 4.5L13.5 13.5" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" />
                </svg>
            </button>
            <div class="toast-progress"></div>
        </div>

        <div *ngIf="successMessage" class="toast toast-pink">
            <div class="toast-icon-wrapper">
                <svg class="toast-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path
                        d="M10 18C14.4183 18 18 14.4183 18 10C18 5.58172 14.4183 2 10 2C5.58172 2 2 5.58172 2 10C2 14.4183 5.58172 18 10 18Z"
                        fill="currentColor" fill-opacity="0.15" />
                    <path d="M6 10L8.5 12.5L14 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </div>
            <div class="toast-body">
                <div class="toast-title">Success</div>
                <div class="toast-message">{{ successMessage }}</div>
            </div>
            <button type="button" class="toast-close" (click)="successMessage = ''" aria-label="Close">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <path d="M13.5 4.5L4.5 13.5M4.5 4.5L13.5 13.5" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" />
                </svg>
            </button>
            <div class="toast-progress"></div>
        </div>
    </div>

    <div *ngIf="isLoading" class="loading-container">
        <div class="spinner"></div>
        <p>Loading orders...</p>
    </div>

    <div *ngIf="!isLoading" class="management-content">
        <!-- Order Details Modal -->
        <div *ngIf="showOrderDetails && selectedOrder" class="modal-overlay" (click)="closeOrderDetails()">
            <div class="modal-content order-details-modal" (click)="$event.stopPropagation()">
                <div class="modal-header">
                    <h2>Order #{{ selectedOrder.orderNumber }}</h2>
                    <button class="modal-close" (click)="closeOrderDetails()">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="order-status-card">
                        <span class="status-badge" [class]="getStatusColor(selectedOrder.status)">
                            {{ getStatusLabel(selectedOrder.status) }}
                        </span>
                        <p class="order-id">ID: {{ selectedOrder.id }}</p>
                    </div>

                    <div class="order-info-grid">
                        <div class="info-item">
                            <label>Order Number</label>
                            <p>{{ selectedOrder.orderNumber }}</p>
                        </div>
                        <div class="info-item">
                            <label>Order Date</label>
                            <p>{{ formatDate(selectedOrder.createdAt) }} at {{ formatTime(selectedOrder.createdAt) }}
                            </p>
                        </div>
                        <div class="info-item">
                            <label>Total Amount</label>
                            <p class="amount">EGP {{ selectedOrder.totalAmount | number: '1.2-2' }}</p>
                        </div>
                        <div class="info-item">
                            <label>Customer Name</label>
                            <p>{{ selectedOrder.customerName || 'N/A' }}</p>
                        </div>
                        <div class="info-item">
                            <label>Customer Email</label>
                            <p>{{ selectedOrder.customerEmail || 'N/A' }}</p>
                        </div>
                        <div class="info-item">
                            <label>Items Count</label>
                            <p>{{ selectedOrder.itemCount || selectedOrder.items?.length || 0 }} item{{
                                ((selectedOrder.itemCount || selectedOrder.items?.length || 0) !== 1) ?
                                's' : '' }}</p>
                        </div>
                    </div>

                    <!-- Order Items -->
                    <div class="order-items" *ngIf="selectedOrder.items && selectedOrder.items.length > 0">
                        <h3>Order Items</h3>
                        <div class="items-list">
                            <div class="item-row" *ngFor="let item of selectedOrder.items">
                                <div class="item-name">{{ item.productName }}</div>
                                <div class="item-qty">Qty: {{ item.quantity }}</div>
                                <div class="item-price">EGP {{ item.price | number: '1.2-2' }}</div>

                            </div>
                        </div>
                    </div>

                    <!-- Status Update -->
                    <div class="status-update-section">
                        <h3>Update Order Status</h3>
                        <div class="status-options">
                            <button *ngFor="let status of getAvailableStatuses(selectedOrder.status)" class="status-btn"
                                [class.active]="status.value === selectedOrder.status" [class]="status.color"
                                (click)="updateOrderStatus(status.value)"
                                [disabled]="status.value === selectedOrder.status || updatingStatus">
                                {{ status.label }}
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" (click)="closeOrderDetails()">Close</button>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-section">
            <div class="search-bar">
                <input type="text" placeholder="Search by order number, customer name, or email..."
                    [(ngModel)]="searchTerm" (input)="searchOrders()" class="search-input" />
            </div>
            <div class="status-filter">
                <label for="status-select">Filter by Status:</label>
                <select id="status-select" [(ngModel)]="statusFilter" (change)="onStatusFilterChange()"
                    class="filter-select">
                    <option value="all">All Orders</option>
                    <option value="pending">Pending</option>
                    <option value="processing">Processing</option>
                    <option value="shipped">Shipped</option>
                    <option value="delivered">Delivered</option>
                    <option value="cancelled">Cancelled</option>
                </select>
            </div>
            <span class="result-count">{{ filteredOrders.length }} order{{ filteredOrders.length !== 1 ? 's' : ''
                }}</span>
        </div>

        <!-- Orders Table -->
        <div class="table-section">
            <div class="table-container">
                <table class="orders-table" *ngIf="filteredOrders.length > 0; else noOrders">
                    <thead>
                        <tr>
                            <th class="col-number">Order #</th>
                            <th class="col-customer">Customer</th>
                            <th class="col-amount">Amount</th>
                            <th class="col-status">Status</th>
                            <th class="col-date">Date</th>
                            <th class="col-items">Items</th>
                            <th class="col-actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let order of filteredOrders">
                            <td class="col-number">
                                <span class="order-number">#{{ order.orderNumber }}</span>
                            </td>
                            <td class="col-customer">
                                <div class="customer-info">
                                    <p class="customer-name">{{ order.customerName || 'Unknown' }}</p>
                                    <span class="customer-email">{{ order.customerEmail || 'N/A' }}</span>
                                </div>
                            </td>
                            <td class="col-amount">
                                <span class="amount-badge">EGP {{ order.totalAmount | number: '1.2-2' }}</span>
                            </td>
                            <td class="col-status">
                                <span class="status-badge" [class]="getStatusColor(order.status)">
                                    {{ getStatusLabel(order.status) }}
                                </span>
                            </td>
                            <td class="col-date">
                                <div class="date-info">
                                    <p>{{ formatDate(order.createdAt) }}</p>
                                    <span class="time">{{ formatTime(order.createdAt) }}</span>
                                </div>
                            </td>
                            <td class="col-items">
                                <span class="items-count">{{ order.itemCount || 0 }}</span>
                            </td>
                            <td class="col-actions">
                                <button class="action-view" (click)="viewOrderDetails(order)" title="View Details">
                                    üëÅÔ∏è
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <ng-template #noOrders>
                    <div class="empty-state">
                        <p>{{ searchTerm || statusFilter !== 'all' ? 'No orders found matching your filters' : 'No
                            orders yet' }}</p>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>
</div>