<div class="container">
    <!-- Toast Notifications -->
    <div class="toast-container">
        <div *ngIf="errorMessage" class="toast toast-error">
            <div class="toast-icon-wrapper">
                <svg class="toast-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path
                        d="M10 18C14.4183 18 18 14.4183 18 10C18 5.58172 14.4183 2 10 2C5.58172 2 2 5.58172 2 10C2 14.4183 5.58172 18 10 18Z"
                        fill="currentColor" fill-opacity="0.15" />
                    <path d="M10 6V10M10 14H10.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
            </div>
            <div class="toast-body">
                <div class="toast-title">Error</div>
                <div class="toast-message">{{ errorMessage }}</div>
            </div>
            <button type="button" class="toast-close" (click)="errorMessage = ''" aria-label="Close">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <path d="M13.5 4.5L4.5 13.5M4.5 4.5L13.5 13.5" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" />
                </svg>
            </button>
            <div class="toast-progress"></div>
        </div>

        <div *ngIf="successMessage" class="toast toast-success">
            <div class="toast-icon-wrapper">
                <svg class="toast-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path
                        d="M10 18C14.4183 18 18 14.4183 18 10C18 5.58172 14.4183 2 10 2C5.58172 2 2 5.58172 2 10C2 14.4183 5.58172 18 10 18Z"
                        fill="currentColor" fill-opacity="0.15" />
                    <path d="M6 10L8.5 12.5L14 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </div>
            <div class="toast-body">
                <div class="toast-title">Success</div>
                <div class="toast-message">{{ successMessage }}</div>
            </div>
            <button type="button" class="toast-close" (click)="successMessage = ''" aria-label="Close">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <path d="M13.5 4.5L4.5 13.5M4.5 4.5L13.5 13.5" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" />
                </svg>
            </button>
            <div class="toast-progress"></div>
        </div>
    </div>

    <div class="header-section">
        <div class="title-block">
            <p class="eyebrow">{{ 'HEADER.SHOP' | translate }}</p>
            <h1>{{ 'PRODUCT_LIST.TITLE' | translate }}</h1>
            <p class="subtitle">{{ 'PRODUCT_LIST.SUBTITLE' | translate }}</p>
        </div>

        <div class="filters-card">
            <div class="filters-row">
                <div class="category-filter">
                    <label for="category-select">{{ 'PRODUCT_LIST.CATEGORY' | translate }}</label>
                    <select id="category-select" class="category-select" [(ngModel)]="selectedCategory"
                        (change)="onCategoryChange(selectedCategory)">
                        <option value="">{{ 'PRODUCT_LIST.ALL_CATEGORIES' | translate }}</option>
                        <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
                    </select>
                </div>

                <div class="sort-container">
                    <label for="sort-select">{{ 'PRODUCT_LIST.SORT' | translate }}</label>
                    <select id="sort-select" class="sort-select" [(ngModel)]="sortBy"
                        (change)="loadProducts(searchTerm, selectedCategory)">
                        <option value="">{{ 'PRODUCT_LIST.DEFAULT' | translate }}</option>
                        <option value="price-asc">{{ 'PRODUCT_LIST.PRICE_LOW_HIGH' | translate }}</option>
                        <option value="price-desc">{{ 'PRODUCT_LIST.PRICE_HIGH_LOW' | translate }}</option>
                        <option value="name-asc">{{ 'PRODUCT_LIST.NAME_A_Z' | translate }}</option>
                        <option value="name-desc">{{ 'PRODUCT_LIST.NAME_Z_A' | translate }}</option>
                        <option value="rating-desc">{{ 'PRODUCT_LIST.HIGHEST_RATED' | translate }}</option>
                        <option value="newest">{{ 'PRODUCT_LIST.NEWEST' | translate }}</option>
                    </select>
                </div>
            </div>

            <div class="meta-row" *ngIf="!loading && totalItems">
                <span class="chip filled">{{ totalItems }} {{ 'PRODUCT_LIST.ITEMS' | translate }}</span>
                <span class="chip subtle">{{ 'PRODUCT_LIST.PAGE' | translate }} {{ currentPage }} {{ 'PRODUCT_LIST.OF' |
                    translate }} {{ totalPages || 1 }}</span>
            </div>
        </div>
    </div>

    <div *ngIf="loading" class="loading">
        {{ 'PRODUCT_LIST.LOADING' | translate }}
    </div>
</div>

<div *ngIf="error" class="error">
    {{ error }}
</div>

<div *ngIf="!loading && products.length > 0" class="products-grid">
    <div *ngFor="let product of products" class="product-card" (click)="navigateToProduct(product.id)">
        <div class="product-image">
            <img [src]="product.imageUrl" [alt]="product.name" />
            <span class="badge stock" *ngIf="product.stock === 0">{{ 'PRODUCT_LIST.SOLD_OUT' | translate }}</span>
        </div>
        <div class="product-info">
            <div class="card-top">
                <h3>{{ product.name }}</h3>
                <p class="category">{{ product.category }}</p>
            </div>

            <p class="description">{{ product.description }}</p>

            <div class="product-footer">
                <span class="price">{{ 'COMMON.EGP' | translate }} {{ product.price.toFixed(2) }}</span>
                <span class="rating">‚≠ê {{ product.rating }}</span>
            </div>

            <button (click)="addToCart(product); $event.stopPropagation()" [disabled]="product.stock === 0"
                class="btn-primary-full">
                {{ product.stock > 0 ? ('PRODUCT_LIST.ADD_TO_CART' | translate) : ('PRODUCT_LIST.OUT_OF_STOCK' |
                translate) }}
            </button>

            <div class="actions-secondary">
                <button type="button" class="link-action" (click)="toggleWishlist(product); $event.stopPropagation()">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="none">
                        <path
                            d="M10 17.5C10 17.5 2.5 13 2.5 7.5C2.5 5.84315 3.84315 4.5 5.5 4.5C6.88071 4.5 8.03906 5.35645 8.5 6.5C8.96094 5.35645 10.1193 4.5 11.5 4.5C13.1569 4.5 14.5 5.84315 14.5 7.5C14.5 13 10 17.5 10 17.5Z"
                            [attr.fill]="isInWishlist(product.id) ? 'currentColor' : 'none'" stroke="currentColor"
                            stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    {{ isInWishlist(product.id) ? ('PRODUCT_LIST.SAVED' | translate) : ('PRODUCT_LIST.SAVE' | translate)
                    }}
                </button>
            </div>
        </div>
    </div>

    <div *ngIf="!loading && products.length === 0" class="empty">
        {{ 'PRODUCT_LIST.NO_PRODUCTS' | translate }}
    </div>
</div>

<!-- Pagination Controls -->
<div *ngIf="!loading && totalPages > 1" class="pagination-container">
    <div class="pagination-info">
        {{ 'PRODUCT_LIST.SHOWING' | translate }} {{ (currentPage - 1) * pageSize + 1 }} - {{ Math.min(currentPage *
        pageSize, totalItems) }} {{ 'PRODUCT_LIST.OF' | translate }} {{
        totalItems }} {{ 'PRODUCT_LIST.PRODUCTS' | translate }}
    </div>

    <div class="pagination">
        <button class="pagination-btn prev-btn" [disabled]="currentPage === 1" (click)="previousPage()"
            [class.disabled]="currentPage === 1">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
            {{ 'COMMON.PREVIOUS' | translate }}
        </button>

        <button *ngIf="getPageNumbers()[0] > 1" class="pagination-btn page-btn" (click)="goToPage(1)">
            1
        </button>

        <span *ngIf="getPageNumbers()[0] > 2" class="pagination-ellipsis">...</span>

        <button *ngFor="let page of getPageNumbers()" class="pagination-btn page-btn"
            [class.active]="page === currentPage" (click)="goToPage(page)">
            {{ page }}
        </button>

        <span *ngIf="getPageNumbers()[getPageNumbers().length - 1] < totalPages - 1"
            class="pagination-ellipsis">...</span>

        <button *ngIf="getPageNumbers()[getPageNumbers().length - 1] < totalPages" class="pagination-btn page-btn"
            (click)="goToPage(totalPages)">
            {{ totalPages }}
        </button>

        <button class="pagination-btn next-btn" [disabled]="currentPage === totalPages" (click)="nextPage()"
            [class.disabled]="currentPage === totalPages">
            {{ 'COMMON.NEXT' | translate }}
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </button>
    </div>
</div>